{% extends "auth_base.html" %}

{% block title %}忘记密码 - Trend-Autostop{% endblock %}

{% block content %}
<div class="auth-card">
    <h2 class="auth-title">忘记密码</h2>
    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 24px;">
        输入您的邮箱地址，我们将发送重置密码链接。
    </p>
    
    <form id="forgot-form">
        <div class="form-group">
            <label class="form-label" for="email">邮箱地址</label>
            <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input" 
                placeholder="your@email.com"
                required
                autocomplete="email"
            >
        </div>
        
        <button type="submit" class="btn btn-primary">
            <span class="btn-text">发送重置链接</span>
            <span class="loading"></span>
        </button>
    </form>
    
    <div class="auth-footer">
        <p>记起密码了？<a href="/auth/login">返回登录</a></p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('forgot-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const btn = this.querySelector('button[type="submit"]');
    btn.classList.add('loading-state');
    btn.disabled = true;
    
    try {
        const response = await fetch('/api/auth/forgot-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: document.getElementById('email').value
            })
        });
        
        const data = await response.json();
        
        // Always show success message (don't reveal if email exists)
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success';
        alertDiv.textContent = '如果该邮箱已注册，重置密码链接已发送到您的邮箱。';
        
        const existingAlert = this.querySelector('.alert');
        if (existingAlert) {
            existingAlert.remove();
        }
        this.insertBefore(alertDiv, this.firstChild);
        
    } catch (error) {
        console.error('Forgot password error:', error);
        alert('网络错误，请重试');
    } finally {
        btn.classList.remove('loading-state');
        btn.disabled = false;
    }
});
</script>
{% endblock %}

