{% extends "auth_base.html" %}

{% block title %}ç™»å½• - Trend-Autostop{% endblock %}

{% block content %}
<div class="auth-card">
    <h2 class="auth-title">æ¬¢è¿å›æ¥</h2>
    
    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}
    
    {% if message %}
    <div class="alert alert-success">{{ message }}</div>
    {% endif %}
    
    <form id="login-form" action="/auth/login" method="POST">
        <div class="form-group">
            <label class="form-label" for="email">é‚®ç®±åœ°å€</label>
            <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input" 
                placeholder="your@email.com"
                required
                autocomplete="email"
            >
        </div>
        
        <div class="form-group">
            <label class="form-label" for="password">å¯†ç </label>
            <div class="password-toggle">
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    class="form-input" 
                    placeholder="è¾“å…¥å¯†ç "
                    required
                    autocomplete="current-password"
                >
                <button type="button" class="toggle-btn">ğŸ‘ï¸</button>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
            <span class="btn-text">ç™»å½•</span>
            <span class="loading"></span>
        </button>
        
        <div class="auth-links">
            <a href="/auth/forgot-password">å¿˜è®°å¯†ç ï¼Ÿ</a>
        </div>
    </form>
    
    <div class="auth-footer">
        <p>è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ<a href="/auth/register">ç«‹å³æ³¨å†Œ</a></p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const btn = this.querySelector('button[type="submit"]');
    btn.classList.add('loading-state');
    btn.disabled = true;
    
    const formData = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value
    };
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // Redirect to dashboard on success
            window.location.href = '/';
        } else {
            // Show error
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-error';
            alertDiv.textContent = data.detail || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•';
            
            const existingAlert = this.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            this.insertBefore(alertDiv, this.firstChild);
        }
    } catch (error) {
        console.error('Login error:', error);
        alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
    } finally {
        btn.classList.remove('loading-state');
        btn.disabled = false;
    }
});
</script>
{% endblock %}

