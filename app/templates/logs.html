{% extends "base.html" %}

{% block title %}æ“ä½œæ—¥å¿— - Trend-Autostop{% endblock %}

{% block page_title %}æ“ä½œæ—¥å¿—{% endblock %}

{% block content %}
<section class="card full-width">
    <div class="card-header">
        <h2>å…¨éƒ¨æ—¥å¿—</h2>
        <div class="header-controls">
            <button class="btn btn-ghost btn-sm" onclick="location.reload()">
                ğŸ”„ åˆ·æ–°
            </button>
        </div>
    </div>
    <div class="card-body">
        {% if logs %}
        <div class="table-responsive">
            <table class="data-table logs-table">
                <thead>
                    <tr>
                        <th style="width: 140px;">æ—¶é—´</th>
                        <th style="width: 100px;">æ“ä½œ</th>
                        <th style="width: 120px;">äº¤æ˜“å¯¹</th>
                        <th>æ¶ˆæ¯</th>
                        <th style="width: 180px;">ä»·æ ¼å˜åŠ¨</th>
                        <th style="width: 60px;">çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr class="{% if not log.success %}row-error{% endif %}">
                        <td class="mono text-muted">{{ log.created_at.strftime('%m-%d %H:%M:%S') }}</td>
                        <td>
                            <span class="action-badge action-{{ log.action }}">
                                {% if log.action == 'update_stop' %}ğŸ¯
                                {% elif log.action == 'create_config' %}â•
                                {% elif log.action == 'manual_adjust' %}âœï¸
                                {% elif log.action == 'error' %}âŒ
                                {% elif log.action == 'info' %}â„¹ï¸
                                {% else %}ğŸ“‹
                                {% endif %}
                                {{ log.action }}
                            </span>
                        </td>
                        <td class="symbol">{{ log.symbol or '--' }}</td>
                        <td class="log-message-cell">{{ log.message }}</td>
                        <td class="mono">
                            {% if log.old_value and log.new_value %}
                            <span class="price-change">
                                {{ "%.4f"|format(log.old_value) }}
                                <span class="arrow">â†’</span>
                                {{ "%.4f"|format(log.new_value) }}
                            </span>
                            {% else %}
                            <span class="text-muted">--</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if log.success %}
                            <span class="status-dot success" title="æˆåŠŸ"></span>
                            {% else %}
                            <span class="status-dot error" title="{{ log.error_message or 'å¤±è´¥' }}"></span>
                            {% endif %}
                        </td>
                    </tr>
                    {% if log.error_message %}
                    <tr class="error-detail-row">
                        <td colspan="6">
                            <div class="error-detail">{{ log.error_message }}</div>
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <p>æš‚æ— æ“ä½œæ—¥å¿—</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

